var rpn;!function(a){var b;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"}(b||(b={}));var c=function(){function a(){this.dataStore=[]}return a.prototype.push=function(a){this.dataStore.push(a)},a.prototype.pop=function(){return this.dataStore.pop()},a.prototype.getPeek=function(){return 0==this.dataStore.length?null:this.dataStore[this.dataStore.length-1]},Object.defineProperty(a.prototype,"length",{get:function(){return this.dataStore.length},enumerable:!0,configurable:!0}),a}(),d=function(){function a(){}return a.getOperatorsInfo=function(b){var c=a.Operators[b];return"undefined"==c?null:c},Object.defineProperty(a,"operatorsText",{get:function(){var b=[];for(var c in a.Operators)b.push(c);return b.join("")},enumerable:!0,configurable:!0}),a.isNumChar=function(a){return a>="0"&&"9">=a||"%.".indexOf(a)>=0},a.isValidParenthesisNumber=function(a){for(var b,c=0,d=0,e=0,f=a.length;f>e;e++)b=a[e],"("==b?c++:")"==b&&d++;return c==d},a.splitIntoTerms=function(b){var c,d,e,f,g=[],h=!0,i="";b=b.replace(/\s/g,"");for(var j=0,k=b.length;k>j;j++)if(c=b[j],"/*^()".indexOf(c)>=0)g.push(c),")"!=c&&(h=!0);else if("+-".indexOf(c)>=0){if(k>j+1&&(d=b[j+1],"+-".indexOf(d)>=0)){switch(e=c+d,j++,e){case"++":c="+";break;case"+-":c="-";break;case"-+":c="-";break;case"--":c="+"}if(k>j+1&&"+-".indexOf(b[j+1])>=0)throw new Error("+-が3つ以上連続しています")}h?i=c:g.push(c)}else{for(f="";;){if("."==c){if(f.indexOf(".")>=0)throw new Error("小数点(.)がひとつの数値に複数あります");0==f.length?f="0.":f+=c}else if("%"==c){if(""==f)throw new Error("パーセント(%)が数値なしで使われています");if(f.indexOf("%")>=0)throw new Error("複数のパーセント(%)がひとつの数値に使われています");f+=c}else{if("%"==f[f.length-1])throw new Error("パーセント(%)の直後に数値が使われています");f+=c}if(j++,j>=k)break;if(c=b[j],!a.isNumChar(c)){j--;break}}"-"==i&&(f="-"+f),g.push(f),i="",h=!1}if(0==g.length)throw new Error("計算式が空です");return g},a.parse=function(b){var d=a.splitIntoTerms(b);if(!a.isValidParenthesisNumber(d))throw new Error('左右の"()"の数が合いません');for(var e,f,g,h,i,j=[],k=new c,l=a.operatorsText,m=0,n=d.length;n>m;m++)if(e=d[m],l.indexOf(e)>=0){for(f=e,g=a.getOperatorsInfo(f),h=k.getPeek(),i=a.getOperatorsInfo(h);null!=i&&l.indexOf(h)>=0&&(0==g.associativity&&g.precedence<=i.precedence||1==g.associativity&&g.precedence<i.precedence)&&(j.push(h),k.pop(),0!=k.length);)h=k.getPeek(),i=a.getOperatorsInfo(h);k.push(f)}else if("("==e)k.push(e);else if(")"==e){for(;"("!=k.getPeek();)if(j.push(k.pop()),0==k.length)throw new Error('"("の数が")"と合いません');k.pop()}else j.push(e);for(;k.length>0;)j.push(k.pop());return j.join(a.RESULT_SEPARATOR)},a.RESULT_SEPARATOR=" ",a.Operators={"^":{precedence:4,associativity:1},"*":{precedence:3,associativity:0},"/":{precedence:3,associativity:0},"+":{precedence:2,associativity:0},"-":{precedence:2,associativity:0}},a}();a.ShuntingYardAlgo=d}(rpn||(rpn={}));var rpn;!function(a){var b=function(){function b(b){this._formulaText=b,this._RPNText=a.ShuntingYardAlgo.parse(b)}return b.prototype.calc=function(){if(null==this._RPNText)throw new Error("計算できません。RPNTextがnulです");for(var b,c,d,e,f,g=this._RPNText.split(a.ShuntingYardAlgo.RESULT_SEPARATOR),h=[],i=a.ShuntingYardAlgo.operatorsText,j=0,k=g.length;k>j;j++)if(d=g[j],i.indexOf(d)>=0){if(h.length<2)throw new Error("計算するのに必要な項が足りません");switch(c=h.pop(),b=new Big(h.pop()),d){case"^":var l;if(l=c instanceof Big?c.toPrecision():c+"",l.indexOf(".")>=0)throw new Error("指数に小数が含まれています");e=b.pow(parseInt(l,10));break;case"*":e=b.times(c);break;case"/":if(0==c)throw new Error("数値を0で割ることはできません");e=b.div(c);break;case"+":e=b.plus(c);break;case"-":e=b.minus(c)}h.push(e)}else d.indexOf("%")>=0?(f=.01,d=d.substr(0,d.indexOf("%"))):f=1,h.push(new Big(d).times(f));if(1!=h.length)throw new Error("項が余りました。計算式の記述に間違いがあります");return this._answer=h.pop().toPrecision(),this._answer},Object.defineProperty(b.prototype,"formulaText",{get:function(){return this._formulaText},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"RPNText",{get:function(){return this._RPNText},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"answer",{get:function(){return this._answer},enumerable:!0,configurable:!0}),b}();a.RPNCalculator=b}(rpn||(rpn={}));