var kk;!function(a){var b=function(){function a(){}return a.getItem=function(a){return a&&this.hasItem(a)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},a.setItem=function(a,b,c,d,e,f){if(void 0===f&&(f=!1),a&&!/^(?:expires|max\-age|path|domain|secure)$/i.test(a)){var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}document.cookie=escape(a)+"="+escape(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":"")}},a.removeItem=function(a,b){a&&this.hasItem(a)&&(document.cookie=escape(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(b?"; path="+b:""))},a.hasItem=function(a){return new RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},a.keys=function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=0;b<a.length;b++)a[b]=unescape(a[b]);return a},a.checkEnabled=function(){var b=!1;try{var c="testEnabled";a.setItem(c,"test"),b=!(null===a.getItem(c)),b&&a.removeItem(c)}catch(d){return!1}return b},a}();a.CookieUtil=b;var c=function(){function a(){}return a.getNow=function(){return new Date},a.afterSeconds=function(b){var c=a.getNow();return c.setTime(c.getTime()+1e3*b),c},a.afterMinutes=function(b){var c=a.getNow();return c.setTime(c.getTime()+60*b*1e3),c},a.afterHours=function(b){var c=a.getNow();return c.setTime(c.getTime()+60*b*60*1e3),c},a.afterDays=function(b){var c=a.getNow();return c.setTime(c.getTime()+24*b*60*60*1e3),c},a}();a.FutureDate=c}(kk||(kk={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},kk;!function(a){var b=function(){function a(){}return a}(),c=function(c){function d(e){if(e instanceof b==0)throw new Error("This class is the singleton pattern. Please use it from AppData.shaedData().");c.call(this),this._formulaItemCollection=new a.FormulaItemCollection,this._taxRate=d.DEFAULT_TAX_RATE,a.CookieUtil.checkEnabled()&&a.CookieUtil.getItem(d.COOKIE_COLOR_THEME)&&(this._colorThemeType=a.CookieUtil.getItem(d.COOKIE_COLOR_THEME))}return __extends(d,c),d.sharedData=function(){return null==d._sharedData&&(d._sharedData=new d(new b)),this._sharedData},Object.defineProperty(d.prototype,"formulaItemCollection",{get:function(){return this._formulaItemCollection},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"taxRate",{get:function(){return this._taxRate},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"colorThemeType",{get:function(){return this._colorThemeType},set:function(b){if(this._colorThemeType!=b){if(this._colorThemeType=b,a.CookieUtil.checkEnabled()){var c=a.FutureDate.afterDays(1);a.CookieUtil.setItem(d.COOKIE_COLOR_THEME,b,c)}this.trigger("colorThemeTypeChange")}},enumerable:!0,configurable:!0}),d.DEFAULT_TAX_RATE=.08,d.COOKIE_COLOR_THEME="color_theme",d}(Backbone.Model);a.AppData=c}(kk||(kk={}));var kk;!function(a){var b=function(a){function b(b){a.call(this),this._char="",this._char=b}return __extends(b,a),Object.defineProperty(b.prototype,"char",{get:function(){return this._char},set:function(a){if(null===a||"undefined"==a)throw new Error("invalid character");if(a.length>1)throw new Error("charcter length should equal to 1");this._char=a,this.trigger("change")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"displayChar",{get:function(){var a=this._char;return a=a.replace(/\*/g,"x")},enumerable:!0,configurable:!0}),b}(Backbone.Model);a.FormulaChar=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(d){var e=[];if(d)if(d instanceof Array)e=d;else if("string"==typeof d){var f=d.split("");_.each(f,function(b){e.push(new a.FormulaChar(b))})}b.call(this,e,{model:a.FormulaChar}),this._caretPosition=c.HIDDEN_CARET_POSITION}return __extends(c,b),c.prototype.hideCaret=function(){this._caretPosition=c.HIDDEN_CARET_POSITION},c.prototype.showCaret=function(){this._caretPosition=this.length},c.prototype.addText=function(b){var d=this;if(this._caretPosition==c.HIDDEN_CARET_POSITION&&(this._caretPosition=0),1==b.length)this.add(new a.FormulaChar(b),{at:this._caretPosition}),this.caretPosition++;else{var e=b.split("");_.each(e,function(b){d.add(new a.FormulaChar(b),{at:d._caretPosition}),d.caretPosition++})}},c.prototype.addTaxText=function(a){var b="*"+(1+a);this.addText(b)},c.prototype.backspaceChar=function(){if(!(this.caretPosition<=0)){var a=this.at(this.caretPosition-1);this.remove(a),this.caretPosition--}},c.prototype.reset=function(a,c){var d=b.prototype.reset.call(this,a,c);return this.caretPosition=0,d},Object.defineProperty(c.prototype,"caretPosition",{get:function(){return this._caretPosition},set:function(a){if(a<c.HIDDEN_CARET_POSITION||a>this.length)throw new Error("Range error. caret position should be within formula text length");this._caretPosition!=a&&(this._caretPosition=a,this.trigger("change",{name:c.CARET_POSITION_CHANGE,data:this._caretPosition}))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isCaretHidden",{get:function(){return this._caretPosition==c.HIDDEN_CARET_POSITION},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"text",{get:function(){var a=[];return _.each(this.models,function(b){a.push(b.char)}),0==a.length?null:a.join("")},set:function(b){var c=[],d=b.split("");_.each(d,function(b){c.push(new a.FormulaChar(b))}),this.reset(c)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"displayText",{get:function(){var a=this.text;return a=a.replace(/\*/g,"x")},enumerable:!0,configurable:!0}),c.CARET_POSITION_CHANGE="caret_position_change",c.HIDDEN_CARET_POSITION=-1,c}(Backbone.Collection);a.FormulaText=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(){b.call(this),this._formulaText=new a.FormulaText}return __extends(c,b),c.prototype.calc=function(){this._calcError=null;try{this._rpnCaluclator=new rpn.RPNCalculator(this.formulaText.text),this._rpnCaluclator.calc()}catch(b){this._rpnCaluclator=null,this._calcError=b}return this.trigger("change",{name:c.CALC_EVENT,data:this}),this.formulaText.caretPosition=a.FormulaText.HIDDEN_CARET_POSITION,this.answer},Object.defineProperty(c.prototype,"answer",{get:function(){return this.hasError?null:null==this._rpnCaluclator?null:this._rpnCaluclator.answer},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"calcError",{get:function(){return this._calcError},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasResult",{get:function(){return this.hasError?!0:null==this._rpnCaluclator?!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasError",{get:function(){return null!=this._calcError},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"forrmulaText",{set:function(a){this._formulaText=a,this.trigger("change",{name:c.FORMULA_TEXT_CHANGE,data:this._formulaText})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"formulaText",{get:function(){return this._formulaText},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"formulaTextLength",{get:function(){return this._formulaText.length},enumerable:!0,configurable:!0}),c.FORMULA_TEXT_CHANGE="formula_text_change",c.CALC_EVENT="calc",c}(Backbone.Model);a.FormulaItem=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(c){b.call(this,c,{model:a.FormulaItem})}return __extends(c,b),Object.defineProperty(c.prototype,"currentFormulaItem",{get:function(){return this._currentFormulaItem},set:function(a){this._currentFormulaItem=a},enumerable:!0,configurable:!0}),c}(Backbone.Collection);a.FormulaItemCollection=b}(kk||(kk={}));var kk;!function(a){var b=function(){function a(){}return a.ALL_CLEAR="allclear",a.COLOR="color",a.HELP="help",a.CLEAR="clear",a.LEFT_PARENTHESIS="(",a.RIGHT_PARENTHESIS=")",a.LEFT_ARROW="<-",a.RIGHT_ARROW="->",a.OPERATOR_PLUS="+",a.OPERATOR_MINUS="-",a.OPERATOR_MULTIPLY="*",a.OPERATOR_DIVIDE="/",a.BACK_SPACE="backspace",a.PERCENT="%",a.TAX="tax",a.EQUAL="equal",a.NUM0="0",a.NUM1="1",a.NUM2="2",a.NUM3="3",a.NUM4="4",a.NUM5="5",a.NUM6="6",a.NUM7="7",a.NUM8="8",a.NUM9="9",a.NUM00="00",a.POINT=".",a}();a.OperationButtonType=b}(kk||(kk={}));var kk;!function(a){var b=function(){function a(){}return a.RED="theme_red",a.ORANGE="theme_orange",a.YELLOW="theme_yellow",a.GREEN="theme_green",a.BLUE="theme_blue",a.PURPLE="theme_purple",a.PINK="theme_pink",a.GRAY="theme_gray",a}();a.ColorThemeType=b}(kk||(kk={}));var kk;!function(a){var b=function(a){function b(c){a.call(this,{tagName:"span",model:c}),this.render(),this._caretPosition=b.CARET_POSITION_NONE}return __extends(b,a),b.prototype.render=function(){return this.$el.text(this.formulaChar.displayChar),this},b.prototype.setCaretClass=function(a){a!=this._caretPosition&&(this._caretPosition==b.CARET_POSITION_LEFT?this.$el.removeClass(b.CARET_LEFT_CLASS_NAME):this._caretPosition==b.CARET_POSITION_RIGHT&&this.$el.removeClass(b.CARET_RIGHT_CLASS_NAME),this._caretPosition=a,this._caretPosition==b.CARET_POSITION_LEFT?this.$el.addClass(b.CARET_LEFT_CLASS_NAME):this._caretPosition==b.CARET_POSITION_RIGHT&&this.$el.addClass(b.CARET_RIGHT_CLASS_NAME))},Object.defineProperty(b.prototype,"formulaChar",{get:function(){return this.model},enumerable:!0,configurable:!0}),b.CARET_POSITION_LEFT="caret_position_left",b.CARET_POSITION_RIGHT="caret_position_right",b.CARET_POSITION_NONE="caret_position_none",b.CARET_LEFT_CLASS_NAME="caret_left",b.CARET_RIGHT_CLASS_NAME="caret_right",b}(Backbone.View);a.FormulaCharView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(c){var d=this;b.call(this,{collection:c,tagName:"li",className:"formula_text"}),this._formulaCharViews=[],this.formulaText.on("add",function(a){d.addCharView(a)}),this.formulaText.on("remove",function(a){d.removeCharView(a)}),this.render(),this.updateCaretPosition(),this.formulaText.on("change",function(b){switch(b.name){case a.FormulaText.CARET_POSITION_CHANGE:d.updateCaretPosition()}}),this.formulaText.on("reset",function(a,b){d.resetView(a,b)})}return __extends(c,b),c.prototype.addCharView=function(b){this.$el.find(".empty_caret").remove();var c=this.formulaText.indexOf(b),d=new a.FormulaCharView(b);0==this._formulaCharViews.length?this.$el.append(d.el):0==c?this.$el.prepend(d.el):this._formulaCharViews[c-1].$el.after(d.el),this._formulaCharViews.splice(c,0,d)},c.prototype.removeCharView=function(a){var b=this.findCharView(a);if(null!=b){b===this._caretFormulaCharView&&(this._caretFormulaCharView=null);var c=this._formulaCharViews.indexOf(b);this._formulaCharViews.splice(c,1),b.$el.remove(),0==this.formulaText.length&&this.addEmptyCharView()}},c.prototype.findCharView=function(a){for(var b=null,c=0,d=this._formulaCharViews.length;d>c;c++)if(b=this._formulaCharViews[c],b.formulaChar===a)return b;return null},c.prototype.resetView=function(){for(var a,b=this._formulaCharViews.length-1;b>=0;b--)a=this._formulaCharViews.pop(),a.$el.remove();this._formulaCharViews=[],this.addEmptyCharView()},c.prototype.addEmptyCharView=function(){this.$el.html('<span class="caret_left empty_caret">&nbsp;</span>')},c.prototype.render=function(){this._formulaCharViews=[],this.$el.empty();var a=this;return this.formulaText.each(function(b){a.addCharView(b)}),this},c.prototype.updateCaretPosition=function(){null!=this._caretFormulaCharView&&(this._caretFormulaCharView.setCaretClass(a.FormulaCharView.CARET_POSITION_NONE),this._caretFormulaCharView=null);var b=this.formulaText.caretPosition;b!=a.FormulaText.HIDDEN_CARET_POSITION&&0!=this.formulaText.length&&(b==this.formulaText.length?(this._caretFormulaCharView=this._formulaCharViews[b-1],this._caretFormulaCharView.setCaretClass(a.FormulaCharView.CARET_POSITION_RIGHT)):(this._caretFormulaCharView=this._formulaCharViews[b],this._caretFormulaCharView.setCaretClass(a.FormulaCharView.CARET_POSITION_LEFT)))},Object.defineProperty(c.prototype,"formulaText",{get:function(){return this.collection},enumerable:!0,configurable:!0}),c}(Backbone.View);a.FormulaTextView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(c){var d=this;b.call(this,{model:c,tagName:"ul",id:c.cid}),this._resultTemplate=_.template($("#formula_item_result_template").html()),this.render(),this.formulaItem.on("change",function(b){b.name==a.FormulaItem.CALC_EVENT&&d.onCalc()})}return __extends(c,b),c.prototype.render=function(){return this.renderFormulaText(),this.renderFormulaResult(),this},c.prototype.getResultTemplateArg=function(){var a={};return this.formulaItem.hasResult?this.formulaItem.hasError?(a.hasError=!0,a.errorMsg=this.formulaItem.calcError):(a.hasError=!1,a.answer="= "+this.formulaItem.answer):(a.hasError=!1,a.answer="&nbsp;"),a},c.prototype.onCalc=function(){this.renderFormulaResult()},c.prototype.renderFormulaText=function(){this._formulaTextView&&(this._formulaTextView.$el.remove(),this._formulaTextView=null),this._formulaTextView=new a.FormulaTextView(this.formulaItem.formulaText),this.$el.append(this._formulaTextView.el)},c.prototype.renderFormulaResult=function(){this._formulaResult&&(this._formulaResult.remove(),this._formulaResult=null),this._formulaResult=$(this._resultTemplate(this.getResultTemplateArg())),this.$el.append(this._formulaResult)},Object.defineProperty(c.prototype,"formulaItem",{get:function(){return this.model},enumerable:!0,configurable:!0}),c}(Backbone.View);a.FormulaItemView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(c){var d=this;b.call(this,{collection:a.AppData.sharedData().formulaItemCollection}),this._formulaItemViews=[],this._viewHeight=c,this.collection.on("add",function(a){d.addFormulaItemView(a)}),this.collection.on("remove",function(a){d.removeFormulaItemView(a)}),this.collection.on("reset",function(a,b){d.removeAllFormulaItemViews(a,b)}),this.$el=$("#formula_item_collection_view"),this.$el.css("height",c+"px"),this._scrollContentArea=$("#formula_item_collection_view_scroll_area"),this._ftScroller=new FTScroller(this.$el.get(0),{scrollingX:!1,bouncing:!1}),this._ftScroller.addEventListener("scroll",function(){d._isFTScrolled=!0,null!=d._currentTouchDownULObj&&d._currentTouchDownULObj.removeClass("current")}),this.$el.on("touchstart mousedown",function(a){a.preventDefault(),d.onToushStart(a)}).on("touchend mouseup",function(a){a.preventDefault(),d.onTouchEnd(a)})}return __extends(c,b),c.prototype.onToushStart=function(a){var b=a.target.tagName.toLowerCase();if(this._currentTouchDownULObj=null,this._isFTScrolled=!1,"li"==b)this._currentTouchDownULObj=$(a.target).parent();else{if("span"!=b)return;this._currentTouchDownULObj=$(a.target).parentsUntil("ul").parent()}null!=this._currentTouchDownULObj&&this._currentTouchDownULObj.addClass("current")},c.prototype.onTouchEnd=function(a){var b,c=a.target.tagName.toLowerCase();if("li"==c?b=$(a.target).parent():"span"==c&&(b=$(a.target).parentsUntil("ul").parent()),null!=this._currentTouchDownULObj){this._currentTouchDownULObj.removeClass("current");var d=this._currentTouchDownULObj.attr("id");b&&b.attr("id")==d&&0==this._isFTScrolled&&this.onItemTap(d)}},c.prototype.onItemTap=function(b){var c=a.AppData.sharedData().formulaItemCollection.get(b);c&&c!=a.AppData.sharedData().formulaItemCollection.currentFormulaItem&&this.addTappedItemResultTextIntoCurrentItem(c)},c.prototype.addTappedItemResultTextIntoCurrentItem=function(b){if(b.hasResult&&!b.hasError){var c=a.AppData.sharedData().formulaItemCollection.currentFormulaItem;if(null==c){var d=new a.FormulaItem;a.AppData.sharedData().formulaItemCollection.add(d),a.AppData.sharedData().formulaItemCollection.currentFormulaItem=d,d.formulaText.showCaret(),c=d}var e=b.answer;e.indexOf("-")<0&&(e="+"+e),c.formulaText.addText(e)}},c.prototype.resize=function(a){this._viewHeight=a,this.$el.css("height",a+"px")},c.prototype.addFormulaItemView=function(b){var c=this,d=new a.FormulaItemView(b);this._formulaItemViews.push(d),this._scrollContentArea.append(d.el);var e=this._ftScroller.scrollHeight;setTimeout(function(){e+=$(d.el).innerHeight(),e>c._viewHeight&&c._ftScroller.scrollTo(0,e-c._viewHeight,400)},100)},c.prototype.removeFormulaItemView=function(a){var b=this.findFormulaItemView(a);if(null!=b){var c=this._formulaItemViews.indexOf(b);this._formulaItemViews.splice(c,1),b.$el.remove()}},c.prototype.removeAllFormulaItemViews=function(){for(var a,b=this._formulaItemViews.length-1;b>=0;b--)a=this._formulaItemViews.pop(),a.$el.remove();this._formulaItemViews=[]},c.prototype.findFormulaItemView=function(a){for(var b,c=0,d=this._formulaItemViews.length;d>c;c++)if(b=this._formulaItemViews[c],a===b.formulaItem)return b;return null},Object.defineProperty(c.prototype,"formulaItemCollection",{get:function(){return this.collection},enumerable:!0,configurable:!0}),c}(Backbone.View);a.FormulaItemCollectionView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(d){var e=this;b.call(this,{el:d}),this._buttonType=c.buttonIdTable[d.id],this._formulaItemCollection=a.AppData.sharedData().formulaItemCollection,this.$el.on("touchstart mousedown",function(a){a.preventDefault(),e.$el.addClass("current")}).on("touchend mouseup",function(a){a.preventDefault(),e.$el.removeClass("current"),e.onTap()})}return __extends(c,b),c.prototype.onTap=function(){switch(this._buttonType){case a.OperationButtonType.NUM0:case a.OperationButtonType.NUM1:case a.OperationButtonType.NUM2:case a.OperationButtonType.NUM3:case a.OperationButtonType.NUM4:case a.OperationButtonType.NUM5:case a.OperationButtonType.NUM6:case a.OperationButtonType.NUM7:case a.OperationButtonType.NUM8:case a.OperationButtonType.NUM9:case a.OperationButtonType.NUM00:case a.OperationButtonType.POINT:case a.OperationButtonType.LEFT_PARENTHESIS:case a.OperationButtonType.RIGHT_PARENTHESIS:case a.OperationButtonType.PERCENT:this.addText(this._buttonType);break;case a.OperationButtonType.OPERATOR_PLUS:case a.OperationButtonType.OPERATOR_MINUS:case a.OperationButtonType.OPERATOR_MULTIPLY:case a.OperationButtonType.OPERATOR_DIVIDE:this.addOperator();break;case a.OperationButtonType.LEFT_ARROW:case a.OperationButtonType.RIGHT_ARROW:this.moveCaret();break;case a.OperationButtonType.BACK_SPACE:this.backspaceChar();break;case a.OperationButtonType.CLEAR:this.clearText();break;case a.OperationButtonType.ALL_CLEAR:this.allClearFormulaItems();break;case a.OperationButtonType.COLOR:case a.OperationButtonType.HELP:this.trigger("tap",this);break;case a.OperationButtonType.TAX:this.addTaxText();break;case a.OperationButtonType.EQUAL:this.calc()}},c.prototype.addText=function(a){null==this._formulaItemCollection.currentFormulaItem&&this.addEmptyFormulaItem();var b=this._formulaItemCollection.currentFormulaItem;b.formulaText.isCaretHidden&&b.formulaText.showCaret(),b.formulaText.addText(a)},c.prototype.moveCaret=function(){if(null!=this._formulaItemCollection.currentFormulaItem){var b=this._formulaItemCollection.currentFormulaItem.formulaText,c=b.caretPosition;this._buttonType==a.OperationButtonType.LEFT_ARROW?(c--,0>c&&(c=0)):this._buttonType==a.OperationButtonType.RIGHT_ARROW&&(c++,c>b.length&&(c=b.length)),b.caretPosition=c}},c.prototype.addEmptyFormulaItem=function(){var b=new a.FormulaItem;this._formulaItemCollection.add(b),this._formulaItemCollection.currentFormulaItem=b},c.prototype.backspaceChar=function(){if(null!=this._formulaItemCollection.currentFormulaItem){var a=this._formulaItemCollection.currentFormulaItem;a.formulaText.backspaceChar()}},c.prototype.addOperator=function(){if(null==this._formulaItemCollection.currentFormulaItem){if(0==this._formulaItemCollection.length)return;var a=this._formulaItemCollection.at(this._formulaItemCollection.length-1);if(!a.hasResult||0!=a.hasError)return;this.addText(a.answer)}this.addText(this._buttonType)},c.prototype.calc=function(){null!=this._formulaItemCollection.currentFormulaItem&&0!=this._formulaItemCollection.currentFormulaItem.formulaText.length&&(this._formulaItemCollection.currentFormulaItem.calc(),this._formulaItemCollection.currentFormulaItem=null)},c.prototype.clearText=function(){if(null!=this._formulaItemCollection.currentFormulaItem){var a=this._formulaItemCollection.currentFormulaItem.formulaText;a.reset()}},c.prototype.allClearFormulaItems=function(){this._formulaItemCollection.reset(),this._formulaItemCollection.currentFormulaItem=null},c.prototype.addTaxText=function(){null!=this._formulaItemCollection.currentFormulaItem&&this._formulaItemCollection.currentFormulaItem.formulaText.addTaxText(a.AppData.sharedData().taxRate)},Object.defineProperty(c.prototype,"buttonType",{get:function(){return this._buttonType},enumerable:!0,configurable:!0}),c.buttonIdTable={btn_ac:a.OperationButtonType.ALL_CLEAR,btn_color:a.OperationButtonType.COLOR,btn_help:a.OperationButtonType.HELP,btn_c:a.OperationButtonType.CLEAR,btn_left_paren:a.OperationButtonType.LEFT_PARENTHESIS,btn_right_paren:a.OperationButtonType.RIGHT_PARENTHESIS,btn_left_arrow:a.OperationButtonType.LEFT_ARROW,btn_right_arrow:a.OperationButtonType.RIGHT_ARROW,btn_plus:a.OperationButtonType.OPERATOR_PLUS,btn_minus:a.OperationButtonType.OPERATOR_MINUS,btn_multi:a.OperationButtonType.OPERATOR_MULTIPLY,btn_devide:a.OperationButtonType.OPERATOR_DIVIDE,btn_bs:a.OperationButtonType.BACK_SPACE,btn_percent:a.OperationButtonType.PERCENT,btn_tax:a.OperationButtonType.TAX,btn_eq:a.OperationButtonType.EQUAL,btn_num0:a.OperationButtonType.NUM0,btn_num1:a.OperationButtonType.NUM1,btn_num2:a.OperationButtonType.NUM2,btn_num3:a.OperationButtonType.NUM3,btn_num4:a.OperationButtonType.NUM4,btn_num5:a.OperationButtonType.NUM5,btn_num6:a.OperationButtonType.NUM6,btn_num7:a.OperationButtonType.NUM7,btn_num8:a.OperationButtonType.NUM8,btn_num9:a.OperationButtonType.NUM9,btn_num00:a.OperationButtonType.NUM00,btn_point:a.OperationButtonType.POINT},c}(Backbone.View);a.OperationButtonView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(){var c=this;b.call(this),this.$el=$("#operation_buttons_container_view"),this._buttonViews=[];var d;this.$el.find(".op_btn").each(function(b,e){d=new a.OperationButtonView(e),c._buttonViews.push(d),(d.buttonType==a.OperationButtonType.COLOR||d.buttonType==a.OperationButtonType.HELP)&&d.on("tap",function(a){c.onButtonViewTap(a)})})}return __extends(c,b),c.prototype.onButtonViewTap=function(a){var b=a;this.trigger("pushView",b.buttonType)},c}(Backbone.View);a.OperationButtonsContainerView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(){var c=this;b.call(this),this.$el=$("#wrapper"),this._operationButtonsContainerView=new a.OperationButtonsContainerView,this._formulaItemCollectionView=new a.FormulaItemCollectionView(this.calcFormulaCollectionViewHeight()),this._colorSettingsScene=new a.ColorSettingsScene,this._helpScene=new a.HelpScene,this.setupColorTheme(),window.onresize=function(){c._formulaItemCollectionView.resize(c.calcFormulaCollectionViewHeight()),c._colorSettingsScene.resize(),c._helpScene.resize()},this._operationButtonsContainerView.on("pushView",function(a){c.pushView(a)}),this._colorSettingsScene.on("popView",function(){c.popView()}),this._helpScene.on("popView",function(){c.popView()}),a.AppData.sharedData().on("colorThemeTypeChange",function(){c.updateColorTheme()})}return __extends(c,b),c.prototype.pushView=function(b){b==a.OperationButtonType.COLOR?(this._colorSettingsScene.$el.show(),this._helpScene.$el.hide()):b==a.OperationButtonType.HELP&&(this._colorSettingsScene.$el.hide(),this._helpScene.$el.show()),$("#wrapper_scroll_contents").ratween({"margin-left":"-100%"},{time:.5,easing:"easeInOutQuart"})},c.prototype.popView=function(){$("#wrapper_scroll_contents").ratween({"margin-left":"0px"},{time:.5,easing:"easeInOutQuart"})},c.prototype.setupColorTheme=function(){for(var b=this.$el.attr("class"),c=b.split(" "),d=0,e=c.length;e>d;d++)if(c[d].indexOf("theme_")>=0){this._currentColorThemeType=c[d],a.AppData.sharedData().colorThemeType?this.updateColorTheme():a.AppData.sharedData().colorThemeType=c[d];break}},c.prototype.updateColorTheme=function(){this.$el.removeClass(this._currentColorThemeType),this._currentColorThemeType=a.AppData.sharedData().colorThemeType,this.$el.addClass(this._currentColorThemeType)},c.prototype.calcFormulaCollectionViewHeight=function(){var a=window.innerHeight,b=this._operationButtonsContainerView.$el.innerHeight();return a-b},c}(Backbone.View);a.WrapperView=b}(kk||(kk={}));var kk;!function(a){var b=function(b){function c(){var a=this;b.call(this),this._isListScrolled=!1,this.$el=$("#color_setting_scene"),this._backButton=$("#color_setting_back_button"),this.setupListheight(),this._backButton.on("touchstart mousedown",function(b){b.preventDefault(),a._backButton.addClass("current")}).on("touchend mouseup",function(b){b.preventDefault(),a._backButton.removeClass("current"),a.trigger("popView")}),$("#color_setting_list li").on("touchstart mousedown",function(b){b.preventDefault(),a._isListScrolled=!1,$(b.target).addClass("current")}).on("touchend mouseup",function(b){b.preventDefault(),$(b.target).removeClass("current"),0==a._isListScrolled&&(a.changeColorTheme(b.target.id),a.trigger("popView"))})}return __extends(c,b),c.prototype.resize=function(){this.setupListheight()},c.prototype.setupListheight=function(){var a=this,b=window.innerHeight-$("#color_setting_header").innerHeight(),c=$("#color_setting_lsit_area");c.css("height",b),this._ftScroller=new FTScroller(c.get(0),{scrollingX:!1,bouncing:!1}),this._ftScroller.addEventListener("scroll",function(){a._isListScrolled=!0})},c.prototype.changeColorTheme=function(b){a.AppData.sharedData().colorThemeType=c.buttonIdTable[b]},c.buttonIdTable={color_btn_red:a.ColorThemeType.RED,color_btn_orange:a.ColorThemeType.ORANGE,color_btn_yellow:a.ColorThemeType.YELLOW,color_btn_green:a.ColorThemeType.GREEN,color_btn_blue:a.ColorThemeType.BLUE,color_btn_purple:a.ColorThemeType.PURPLE,color_btn_pink:a.ColorThemeType.PINK,color_btn_gray:a.ColorThemeType.GRAY},c}(Backbone.View);a.ColorSettingsScene=b}(kk||(kk={}));var kk;!function(a){var b=function(a){function b(){var c=this;a.call(this),this.$el=$("#help_scene"),this._backButton=$("#help_back_button"),this._backButton.on("touchstart mousedown",function(a){a.preventDefault(),c._backButton.addClass("current")}).on("touchend mouseup",function(a){a.preventDefault(),c._backButton.removeClass("current"),c.trigger("popView")}),this._contentArea=$("#help_scene_content"),this._contentArea.load(b.HELP_CONTENT_FILE,function(){c.setupContentHeight()})}return __extends(b,a),b.prototype.resize=function(){this.setupContentHeight()},b.prototype.setupContentHeight=function(){var a=window.innerHeight-$("#help_header").innerHeight(),b=$("#help_scene_content_container");b.css("height",a),this._ftScroller=new FTScroller(b.get(0),{scrollingX:!1,bouncing:!1})},b.HELP_CONTENT_FILE="help_content.html",b}(Backbone.View);a.HelpScene=b}(kk||(kk={}));var kk;!function(a){var b=function(){function b(){this._wrapperView=new a.WrapperView}return b}();a.CalcMain=b}(kk||(kk={}));